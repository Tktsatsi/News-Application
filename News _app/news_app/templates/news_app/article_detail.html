{% extends 'news_app/base.html' %}
{% load static %}

{% block title %}{{ article.title }} - News App{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'news_app/articles.css' %}">
{% endblock %}

{% block content %}
    <div class="article-hero">
        <div class="article-header">
            <h1 class="article-title-main">{{ article.title }}</h1>
            
            <div class="article-meta-bar">
                <div class="meta-item">
                    <span>ğŸ‘¤</span>
                    <span>By <strong>{{ article.author.username }}</strong></span>
                </div>
                <div class="meta-item">
                    <span>ğŸ“…</span>
                    <span>{{ article.published_date|date:"F d, Y" }}</span>
                </div>
                {% if article.publisher %}
                <div class="meta-item">
                    <span>ğŸ¢</span>
                    <span><strong>{{ article.publisher.name }}</strong></span>
                </div>
                {% endif %}
                <div class="meta-item">
                    <span>Status:</span>
                    <span class="status-badge status-{{ article.status }}">
                        {{ article.get_status_display }}
                    </span>
                </div>
            </div>
        </div>
        {% if article.is_rejected %}
        <div class="rejection-notice">
            <h4>âŒ This article was rejected</h4>
            <p><strong>Reason:</strong> {{ article.rejected_reason }}</p>

            {% if article.rejected_by %}
                <p><strong>Rejected by:</strong> {{ article.rejected_by.username }}</p>
            {% endif %}

            <p><strong>Date:</strong> {{ article.rejected_date|date:"F d, Y H:i" }}</p>
        </div>
        {% endif %}

        {% if article.image %}
            <div class="article-image">
                <img src="{{ article.image.url }}" alt="{{ article.title }}">
            </div>
        {% else %}
            <div class="article-placeholder">
                ğŸ“°
            </div>
        {% endif %}
    </div>
    
    {% if article.summary %}
    <div class="article-content-section article-summary-section">
        <h3>ğŸ“ Summary</h3>
        <p class="article-summary-text">{{ article.summary }}</p>
    </div>
    {% endif %}
    
    <div class="article-content-section">
        <h3>Article Content</h3>
        {{ article.content|safe }}
    </div>
    
    {% if article.publisher %}
    <div class="publisher-card">
        <h3>ğŸ¢ About {{ article.publisher.name }}</h3>
        <p>{{ article.publisher.description }}</p>
        <a href="{% url 'publisher_detail' article.publisher.pk %}" class="btn btn-secondary btn-sm">
            View Publisher â†’
        </a>
    </div>
    {% endif %}
    
    <div class="action-buttons">
        <a href="{% url 'article_list' %}" class="btn btn-secondary">
            â† Back to Articles
        </a>
        
        {% if user.is_authenticated %}
            {% if user == article.author or user.role == 'editor' or user.role == 'publisher' %}
                <a href="{% url 'edit_article' article.pk %}" class="btn btn-primary">
                    âœï¸ Edit Article
                </a>
                <a href="{% url 'delete_article' article.pk %}" class="btn btn-danger">
                    ğŸ—‘ï¸ Delete Article
                </a>
            {% endif %}
        {% endif %}

        <!-- ğŸ”» Journalist: Publish Independently -->
        {% if user.is_authenticated and user.role == "journalist" and user == article.author %}
            {% if not article.independently_published and not article.is_approved %}
                <a href="{% url 'publish_independently' article.pk %}" class="btn btn-success">
                    ğŸš€ Publish Independently
                </a>
            {% endif %}
        {% endif %}

        <!-- ğŸ”» Editor: Approve / Reject (ONLY if not independent) -->
        {% if user.is_authenticated and user.role == "editor" %}
            {% if not article.independently_published %}
                {% if not article.is_approved and not article.is_rejected %}
                    <a href="{% url 'approve_article' article.pk %}" class="btn btn-primary">
                        âœ”ï¸ Approve
                    </a>
                    <a href="{% url 'reject_article' article.pk %}" class="btn btn-danger">
                        âŒ Reject
                    </a>
                {% endif %}
            {% else %}
                <span class="independent-badge">
                    ğŸ“ This article was published independently by the journalist.
                </span>
            {% endif %}
        {% endif %}
    </div>


{% endblock %}
